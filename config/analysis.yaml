# ============================================================================
# CONFIGURATION DE L'ANALYSE PATRIMONIALE
# ============================================================================
# Ce fichier contient tous les paramètres pour l'analyse du patrimoine :
#   - Optimisation de portefeuille (Markowitz)
#   - Classification des comptes et actifs
#   - Benchmarks d'allocation par profil
#   - Calcul des scores (diversification, résilience, liquidité, fiscalité, croissance)
#   - Profils d'investisseur
#
# Structure:
#   - technical: Paramètres techniques d'optimisation et graphiques
#   - asset_classification: Règles pour classifier les actifs (portfolio optimizer)
#   - account_classification: Règles pour classifier les comptes (analyzer)
#   - benchmarks: Fourchettes cibles par classe d'actifs et profil
#   - scores: Paramètres de calcul des scores
#   - profiles: Profils d'investisseur avec statistiques de marché
# ============================================================================

# ============================================================================
# PARAMÈTRES TECHNIQUES (partagés par tous les profils)
# ============================================================================

technical:
  optimization:
    num_portfolios: 100          # Points pour tracer la frontière efficiente
    max_iterations: 1000         # Itérations max de l'optimiseur
    weight_bounds: [0, 1]        # Contraintes min/max sur les poids (0-100%)
    min_weight_display: 0.01     # Seuil pour afficher dans les résultats (1%)

  charting:
    figure_size: [10, 6]         # Taille du graphique en pouces
    dpi: 100                     # Résolution
    colors:
      efficient_frontier: "#1e3a8a"      # Bleu foncé
      inefficient_frontier: "#1e3a8a"    # Bleu foncé (pointillé)
      current_portfolio: "#b22023"       # Rouge
      optimal_portfolio: "#fbbf24"       # Jaune
      risk_free_line: "gray"             # Ligne taux sans risque
    marker_size: 133
    line_width: 2.5
    line_width_inefficient: 1.5

interpretation_thresholds:
  strong_improvement: 0.5      # Différence Sharpe > 0.5 = forte amélioration
  moderate_improvement: 0.2    # Différence Sharpe > 0.2 = amélioration modérée
  near_optimal: -0.1           # Différence Sharpe > -0.1 = proche optimum

# ============================================================================
# CLASSIFICATION DES ACTIFS
# ============================================================================
# Règles pour identifier automatiquement la classe d'actifs
# à partir des tickers et noms de fonds

asset_classification:

  # Tickers pour identifier les classes d'actifs
  tickers:
    actions_monde:
      - VWCE
      - IWDA
      - SWRD
      - VT
      - ACWI

    actions_europe:
      - EUNL
      - IMEU
      - PAEEM

    actions_usa:
      - VOO
      - SPY
      - IVV
      - VTI

    actions_emergents:
      - VFEM
      - IEMM
      - VWO

    obligations:
      - AGG
      - BND
      - AGGH
      - IEAG

    crypto:
      - BTC
      - ETH
      - USDT
      - USDC

    or:
      - GLD
      - IAU
      - GOLD

  # Mots-clés pour classifier les fonds (assurance-vie, etc.)
  keywords:
    fonds_euro:
      - euro
      - actif euro
      - liquid
      - monetaire
      - money

    actions_emergents:
      - asian
      - asie
      - china
      - chine
      - emergent

    actions_usa:
      - usa
      - america
      - nasdaq
      - s&p

    actions_europe:
      - euro
      - europe
      - action

    obligations_etat:
      - oblig
      - bond

    obligations_corp:
      - corp
      - credit

    immobilier:
      - immo
      - scpi
      - opci
      - edissimmo
      - tangram

# ============================================================================
# CLASSIFICATION DES COMPTES (pour analyzer.py)
# ============================================================================
# Règles pour identifier et classifier les comptes bancaires

account_classification:
  # Mots-clés pour identifier le type de compte
  keywords:
    pea:
      - "pea"
    pea_pme:
      - "pea-pme"
    cto:
      - "cto"
    assurance_vie:
      - "assurance"
      - "vie"
    liquidites:
      - "livret"
      - "ldd"
      - "pel"
      - "dépôt"
      - "compte"
    per:
      - "per"
    parts_sociales:
      - "parts sociales"

  # Mapping type compte → type actif (pour analyzer.py)
  mapping:
    pea: "Actions"
    pea_pme: "Actions"
    cto: "Actions"
    per: "Actions"
    parts_sociales: "Actions"
    liquidites: "Liquidités"
    # Assurance-vie gérée spécialement (UC = Actions, Euro = Obligations)

  # Établissements spéciaux
  special_institutions:
    spiko:
      keyword: "spiko"
      asset_type: "Obligations d'État"
      detail: "T-Bonds"

  # Détection fonds euro dans assurance-vie
  fonds_euro_keywords:
    - "euro"
    - "actif euro"

# Justifications des niveaux de risque
risk_justifications:
  concentration_critical: "Concentration excessive"
  concentration_high: "Concentration importante"
  concentration_normal: "Bien diversifié"
  crypto_platform: "Plateforme crypto"
  precious_metals: "Métaux précieux"

# ============================================================================
# BENCHMARKS PAR CLASSE D'ACTIFS
# ============================================================================
# Format: {min: %, target: %, max: %} pour chaque classe d'actifs
# - min/max: Bornes de la fourchette acceptable
# - target: Cible médiane optimale pour le calcul d'écart
# Varie selon le profil d'investisseur

benchmarks:
  # Profil par défaut (similaire au profil dynamique)
  default:
    Actions:
      min: 60
      target: 65
      max: 70
    Obligations:
      min: 10
      target: 15
      max: 20
    "Obligations d'État":
      min: 10
      target: 15
      max: 20
    Liquidités:
      min: 5
      target: 7.5
      max: 10
    Immobilier:
      min: 20
      target: 25
      max: 30
    Cryptomonnaies:
      min: 0
      target: 2.5
      max: 5
    "Métaux précieux":
      min: 0
      target: 2.5
      max: 5

  # Profil dynamique (jeune, tolérance risque élevée)
  dynamique:
    Actions:
      min: 70
      target: 77.5
      max: 85
    Obligations:
      min: 5
      target: 10
      max: 15
    "Obligations d'État":
      min: 5
      target: 10
      max: 15
    Liquidités:
      min: 5
      target: 7.5
      max: 10
    Immobilier:
      min: 10
      target: 15
      max: 20
    Cryptomonnaies:
      min: 0
      target: 5
      max: 10
    "Métaux précieux":
      min: 0
      target: 2.5
      max: 5

  # Profil équilibré (âge moyen)
  equilibre:
    Actions:
      min: 50
      target: 57.5
      max: 65
    Obligations:
      min: 15
      target: 20
      max: 25
    "Obligations d'État":
      min: 15
      target: 20
      max: 25
    Liquidités:
      min: 5
      target: 7.5
      max: 10
    Immobilier:
      min: 20
      target: 25
      max: 30
    Cryptomonnaies:
      min: 0
      target: 2.5
      max: 5
    "Métaux précieux":
      min: 0
      target: 2.5
      max: 5

  # Profil prudent (proche retraite)
  prudent:
    Actions:
      min: 30
      target: 37.5
      max: 45
    Obligations:
      min: 25
      target: 32.5
      max: 40
    "Obligations d'État":
      min: 25
      target: 32.5
      max: 40
    Liquidités:
      min: 10
      target: 15
      max: 20
    Immobilier:
      min: 20
      target: 25
      max: 30
    Cryptomonnaies:
      min: 0
      target: 1
      max: 2
    "Métaux précieux":
      min: 0
      target: 2.5
      max: 5

# ============================================================================
# CALCUL DES SCORES (0-10)
# ============================================================================
# Paramètres pour le calcul des 5 scores dans analyzer.py

scores:
  # Score diversification (basé sur concentration et dispersion)
  diversification:
    # Pondérations des composantes (doivent totaliser 1.0)
    weights:
      institutional: 0.6        # Poids de la diversification institutionnelle
      jurisdictional: 0.4       # Poids de la diversification juridictionnelle

    # Score de base pour chaque composante
    base_score: 10.0

    # Pénalités pour concentration établissement (score institutionnel)
    penalties:
      establishment_concentration:
        threshold_70: -3.0      # Pénalité si > 70%
        threshold_50: -2.0      # Pénalité si > 50%
        threshold_30: -0.5      # Pénalité si > 30%
      jurisdiction_concentration:
        threshold_85: -2.0      # Pénalité si > 85%

    # Bonus pour diversification intra-portefeuille
    bonuses:
      asset_classes_5plus: 1.0  # Bonus si ≥ 5 classes d'actifs distinctes
      positions_10plus: 0.5     # Bonus si ≥ 10 positions/comptes individuels
      international_15plus: 0.5 # Bonus si exposition internationale > 15%

    # Labels de qualité par tranche de score
    quality_labels:
      - [9, 10, "Excellente diversification"]
      - [7, 9, "Bonne diversification"]
      - [5, 7, "Concentration modérée"]
      - [3, 5, "Forte concentration"]
      - [0, 3, "Concentration critique"]

  # Score résilience (basé sur stress tests et risques)
  resilience:
    base_score: 8.0
    stress_test_penalties:
      Haute: -2.0
      Moyenne: -0.5
    critical_risks_bonus:
      zero_risks: 1.0           # Bonus si 0 risque critique
      three_or_more: -1.5       # Malus si ≥3 risques critiques

    # Labels de qualité par tranche de score
    quality_labels:
      - [9, 10, "Patrimoine résilient"]
      - [7, 9, "Patrimoine solide"]
      - [5, 7, "Patrimoine vulnérable"]
      - [3, 5, "Patrimoine fragile"]
      - [0, 3, "Patrimoine critique"]

  # Score liquidité (basé sur liquidités disponibles, adapté au profil)
  liquidity:
    # Mots-clés pour identifier les comptes liquides
    liquid_account_keywords:
      - "livret"
      - "dépôt"
      - "compte"

    # Ratio dépenses/revenu (estimation)
    expenses_to_income_ratio: 0.7    # 70% du revenu = dépenses

    # Cibles en mois de dépenses par profil investisseur
    target_months_by_profile:
      default: 12           # Profil standard : 12 mois
      dynamique: 9          # Profil dynamique : 9 mois (plus agressif)
      equilibre: 12         # Profil équilibré : 12 mois
      prudent: 15           # Profil prudent : 15 mois (plus conservateur)

    # Seuil de sur-liquidité (pénalisation si dépassé)
    overliquidity_threshold: 1.5    # >150% de la cible = sur-liquidité

    # Barème de scoring (ratio liquidités/cible → score)
    thresholds:
      # Format: [ratio_min, score]
      - [1.5, 9]      # ratio > 1.5 → score 9 (sur-liquidité légère)
      - [1.0, 10]     # ratio >= 1.0 → score 10 (optimal)
      - [0.75, 8]     # ratio >= 0.75 → score 8 (solide)
      - [0.5, 6]      # ratio >= 0.5 → score 6 (acceptable)
      - [0.25, 4]     # ratio >= 0.25 → score 4 (fragile)
      - [0, 2]        # ratio < 0.25 → score 2 (insuffisant)

    default_score: 5      # Score par défaut si impossible à calculer

    # Labels de qualité par tranche de score
    quality_labels:
      - [9, 10, "Excellente liquidité"]
      - [7, 9, "Bonne liquidité"]
      - [5, 7, "Liquidité acceptable"]
      - [3, 5, "Liquidité fragile"]
      - [0, 3, "Liquidité critique"]

  # Score fiscalité (basé sur optimisation fiscale)
  fiscal:
    base_score: 7.0

    # Bonus pour optimisation fiscale
    bonuses:
      pea_over_cto: 1.5        # Bonus si PEA > CTO (fiscalement avantageux)
      av_threshold: 50000      # Seuil AV pour bonus succession
      av_bonus: 0.5            # Bonus AV succession
      per_present: 1.0         # Bonus si PER présent (avantage fiscal à l'entrée)
      per_threshold: 5000      # Seuil minimum PER pour obtenir le bonus

    # Pénalités pour exposition fiscale défavorable
    penalties:
      crypto_high_threshold: 15   # Pénalité si crypto > 15% du patrimoine total
      crypto_high_penalty: -0.5   # Pénalité cryptos élevés (fiscalité lourde)

    # Labels de qualité par tranche de score
    quality_labels:
      - [9, 10, "Optimisation fiscale excellente"]
      - [7, 9, "Bonne structure fiscale"]
      - [5, 7, "Structure fiscale moyenne"]
      - [3, 5, "Structure sous-optimisée"]
      - [0, 3, "Structure fiscale défavorable"]

  # Score croissance (basé sur exposition actions, varie par profil)
  growth:
    # Labels de qualité (communs à tous les profils)
    quality_labels:
      - [9, 10, "Excellent potentiel de croissance"]
      - [7, 9, "Bon potentiel de croissance"]
      - [5, 7, "Potentiel de croissance modéré"]
      - [3, 5, "Potentiel de croissance limité"]
      - [0, 3, "Potentiel de croissance très faible"]

    # Profil default (similaire au profil dynamique)
    default:
      optimal_range: [60, 70]        # Score 10
      good_ranges:                   # Score 8
        - [50, 60]
        - [70, 80]
      medium_ranges:                 # Score 6
        - [40, 50]
        - [80, 90]
      fallback_score: 4              # Autre

    # Profil dynamique (jeune, exposition actions élevée)
    dynamique:
      optimal_range: [70, 85]
      good_ranges:
        - [60, 70]
        - [85, 95]
      medium_ranges:
        - [50, 60]
      fallback_score: 4

    # Profil équilibré
    equilibre:
      optimal_range: [50, 65]
      good_ranges:
        - [40, 50]
        - [65, 75]
      medium_ranges:
        - [30, 40]
        - [75, 85]
      fallback_score: 4

    # Profil prudent (proche retraite, moins d'actions)
    prudent:
      optimal_range: [30, 45]
      good_ranges:
        - [20, 30]
        - [45, 55]
      medium_ranges:
        - [10, 20]
        - [55, 65]
      fallback_score: 4

# ============================================================================
# PROFILS D'INVESTISSEUR
# ============================================================================
# Différentes hypothèses de marché selon le profil de risque

profiles:

  # --------------------------------------------------------------------------
  # PROFIL PAR DÉFAUT (données historiques long terme)
  # --------------------------------------------------------------------------
  default:
    description: "Statistiques historiques moyennes long terme (20-30 ans)"
    market_parameters:
      risk_free_rate: 0.03  # OAT 10 ans France ~3%

    asset_statistics:
      actions_monde:
        rendement: 0.08      # MSCI World historique
        volatilite: 0.15

      actions_europe:
        rendement: 0.07      # Euro Stoxx historique
        volatilite: 0.16

      actions_usa:
        rendement: 0.09      # S&P 500 historique
        volatilite: 0.15

      actions_emergents:
        rendement: 0.10      # MSCI Emerging Markets
        volatilite: 0.22

      obligations_etat:
        rendement: 0.035     # OAT/Bund
        volatilite: 0.05

      obligations_corp:
        rendement: 0.045     # Corporate IG
        volatilite: 0.07

      livrets:
        rendement: 0.03      # Livret A
        volatilite: 0.001

      fonds_euro:
        rendement: 0.025     # Fonds euro assurance-vie
        volatilite: 0.01

      crypto:
        rendement: 0.15      # Bitcoin/crypto (très volatile)
        volatilite: 0.60

      or:
        rendement: 0.04      # Or physique
        volatilite: 0.16

      immobilier:
        rendement: 0.06      # SCPI/Immobilier
        volatilite: 0.12

      autre:
        rendement: 0.05      # Par défaut
        volatilite: 0.10

    correlations:
      # Format: [classe1, classe2, corrélation]
      # Actions entre elles
      - [actions, actions, 0.75]
      # Actions avec autres classes
      - [actions, obligations, 0.15]
      - [actions, crypto, 0.30]
      - [actions, or, 0.10]
      - [actions, immobilier, 0.40]
      - [actions, livrets, 0.0]
      # Obligations avec autres classes
      - [obligations, obligations, 0.80]
      - [obligations, crypto, 0.05]
      - [obligations, or, 0.20]
      - [obligations, immobilier, 0.25]
      - [obligations, livrets, 0.0]
      # Autres corrélations
      - [crypto, crypto, 0.85]
      - [crypto, or, 0.15]
      - [crypto, immobilier, 0.10]
      - [livrets, livrets, 1.0]
      - [or, or, 1.0]
      - [immobilier, immobilier, 1.0]

  # --------------------------------------------------------------------------
  # PROFIL DYNAMIQUE (jeune investisseur, tolérance risque élevée)
  # --------------------------------------------------------------------------
  dynamique:
    description: "Profil jeune (< 40 ans), horizon long terme (20+ ans), tolérance risque élevée"
    market_parameters:
      risk_free_rate: 0.03

    asset_statistics:
      # Hypothèses plus optimistes sur les actions
      actions_monde:
        rendement: 0.09      # +1% vs default
        volatilite: 0.15

      actions_europe:
        rendement: 0.08      # +1% vs default
        volatilite: 0.16

      actions_usa:
        rendement: 0.10      # +1% vs default
        volatilite: 0.15

      actions_emergents:
        rendement: 0.12      # +2% vs default (fort potentiel)
        volatilite: 0.22

      # Obligations moins attractives (taux bas actuels)
      obligations_etat:
        rendement: 0.025     # -1% vs default
        volatilite: 0.05

      obligations_corp:
        rendement: 0.035     # -1% vs default
        volatilite: 0.07

      livrets:
        rendement: 0.03
        volatilite: 0.001

      fonds_euro:
        rendement: 0.02      # -0.5% vs default
        volatilite: 0.01

      crypto:
        rendement: 0.20      # +5% (plus optimiste, horizon long)
        volatilite: 0.60

      or:
        rendement: 0.04
        volatilite: 0.16

      immobilier:
        rendement: 0.07      # +1% vs default
        volatilite: 0.12

      autre:
        rendement: 0.05
        volatilite: 0.10

    correlations:
      - [actions, actions, 0.75]
      - [actions, obligations, 0.15]
      - [actions, crypto, 0.30]
      - [actions, or, 0.10]
      - [actions, immobilier, 0.40]
      - [actions, livrets, 0.0]
      - [obligations, obligations, 0.80]
      - [obligations, crypto, 0.05]
      - [obligations, or, 0.20]
      - [obligations, immobilier, 0.25]
      - [obligations, livrets, 0.0]
      - [crypto, crypto, 0.85]
      - [crypto, or, 0.15]
      - [crypto, immobilier, 0.10]
      - [livrets, livrets, 1.0]
      - [or, or, 1.0]
      - [immobilier, immobilier, 1.0]

  # --------------------------------------------------------------------------
  # PROFIL ÉQUILIBRÉ (âge moyen, risque modéré)
  # --------------------------------------------------------------------------
  equilibre:
    description: "Profil 40-55 ans, horizon moyen terme (10-20 ans), risque modéré"
    market_parameters:
      risk_free_rate: 0.03

    asset_statistics:
      # Mix entre actions et obligations
      actions_monde:
        rendement: 0.075     # Entre default et dynamique
        volatilite: 0.15

      actions_europe:
        rendement: 0.07      # = default
        volatilite: 0.16

      actions_usa:
        rendement: 0.085     # Entre default et dynamique
        volatilite: 0.15

      actions_emergents:
        rendement: 0.09      # Moins agressif que dynamique
        volatilite: 0.22

      obligations_etat:
        rendement: 0.035     # = default
        volatilite: 0.05

      obligations_corp:
        rendement: 0.045     # = default
        volatilite: 0.07

      livrets:
        rendement: 0.03
        volatilite: 0.001

      fonds_euro:
        rendement: 0.025     # = default
        volatilite: 0.01

      crypto:
        rendement: 0.12      # Moins optimiste que dynamique
        volatilite: 0.60

      or:
        rendement: 0.04
        volatilite: 0.16

      immobilier:
        rendement: 0.06      # = default
        volatilite: 0.12

      autre:
        rendement: 0.05
        volatilite: 0.10

    correlations:
      - [actions, actions, 0.75]
      - [actions, obligations, 0.15]
      - [actions, crypto, 0.30]
      - [actions, or, 0.10]
      - [actions, immobilier, 0.40]
      - [actions, livrets, 0.0]
      - [obligations, obligations, 0.80]
      - [obligations, crypto, 0.05]
      - [obligations, or, 0.20]
      - [obligations, immobilier, 0.25]
      - [obligations, livrets, 0.0]
      - [crypto, crypto, 0.85]
      - [crypto, or, 0.15]
      - [crypto, immobilier, 0.10]
      - [livrets, livrets, 1.0]
      - [or, or, 1.0]
      - [immobilier, immobilier, 1.0]

  # --------------------------------------------------------------------------
  # PROFIL PRUDENT (proche retraite, préservation du capital)
  # --------------------------------------------------------------------------
  prudent:
    description: "Profil > 55 ans ou proche retraite, horizon court terme (< 10 ans), risque faible"
    market_parameters:
      risk_free_rate: 0.03

    asset_statistics:
      # Actions moins attractives (risque à limiter)
      actions_monde:
        rendement: 0.07      # -1% vs default
        volatilite: 0.15

      actions_europe:
        rendement: 0.06      # -1% vs default
        volatilite: 0.16

      actions_usa:
        rendement: 0.08      # -1% vs default
        volatilite: 0.15

      actions_emergents:
        rendement: 0.08      # -2% vs default (trop risqué)
        volatilite: 0.22

      # Obligations plus attractives (sécurité)
      obligations_etat:
        rendement: 0.04      # +0.5% vs default (valeur refuge)
        volatilite: 0.05

      obligations_corp:
        rendement: 0.05      # +0.5% vs default
        volatilite: 0.07

      livrets:
        rendement: 0.03
        volatilite: 0.001

      fonds_euro:
        rendement: 0.03      # +0.5% (plus attractif pour capital sûr)
        volatilite: 0.01

      crypto:
        rendement: 0.10      # -5% vs default (trop volatile)
        volatilite: 0.60

      or:
        rendement: 0.045     # +0.5% (valeur refuge)
        volatilite: 0.16

      immobilier:
        rendement: 0.055     # Légèrement réduit
        volatilite: 0.12

      autre:
        rendement: 0.05
        volatilite: 0.10

    correlations:
      - [actions, actions, 0.75]
      - [actions, obligations, 0.15]
      - [actions, crypto, 0.30]
      - [actions, or, 0.10]
      - [actions, immobilier, 0.40]
      - [actions, livrets, 0.0]
      - [obligations, obligations, 0.80]
      - [obligations, crypto, 0.05]
      - [obligations, or, 0.20]
      - [obligations, immobilier, 0.25]
      - [obligations, livrets, 0.0]
      - [crypto, crypto, 0.85]
      - [crypto, or, 0.15]
      - [crypto, immobilier, 0.10]
      - [livrets, livrets, 1.0]
      - [or, or, 1.0]
      - [immobilier, immobilier, 1.0]
