project:
  name: "Patrimoine Analyzer"
  version: "2.1.0"  # Architecture homogène + custodian unifié + multi-file parsing avec cache

paths:
  sources: "sources/"
  templates: "templates/"
  generated: "generated/"
  logs: "logs/"

normalizer:
  input_file: "manifest.json"  # v2.0: manifest.json remplace patrimoine.md
  output_file: "patrimoine_input.json"
  date_format: "ISO8601"

  # Migration v1→v2: Utiliser tools/generate_manifest.py pour générer manifest.json
  # depuis patrimoine.md existant

analyzer:
  input_file: "patrimoine_input.json"
  output_file: "patrimoine_analysis.json"
  web_research:
    enabled: true
    max_queries: 50

    # ========================================
    # Configuration Multi-Provider
    # ========================================

    # Provider principal à utiliser (brave, serper, tavily, ddgs)
    provider: "brave"

    # Activer le fallback automatique si le provider principal échoue
    enable_fallback: true

    # Ordre de fallback (priorité décroissante)
    # 1. Brave - API officielle (2000 req/mois gratuit)
    # 2. Serper - API officielle (2500 req/mois gratuit)
    # 3. Tavily - API officielle (1000 req/mois gratuit)
    # 4. DuckDuckGo - Scraping gratuit illimité (dernier recours)
    fallback_providers:
      - "brave"
      - "serper"
      - "tavily"
      - "ddgs"

    # ========================================
    # Spécialisation par catégorie (v2.2.1)
    # ========================================

    # Assignation de providers par catégorie de recherche
    # Permet d'optimiser la qualité des résultats et de répartir les quotas
    provider_mapping:
      factual: "brave"          # Recherches factuelles/réglementaires (ex: Loi Sapin 2, garantie dépôts)
      quantitative: "serper"    # Données quantitatives (ex: prix immobilier, volatilité)
      contextual: "tavily"      # Analyses contextuelles (ex: risques politiques, tendances marché)
      real_estate: "ddgs"       # Immobilier spécifique (gratuit illimité)

    # Fallback si provider assigné à la catégorie échoue
    enable_category_fallback: true

    # Paramètres par défaut (utilisés si non spécifiés par provider)
    default_rate_limit: 1.3    # Secondes entre requêtes
    default_timeout: 30        # Timeout en secondes
    default_retry_count: 3     # Nombre de tentatives
    default_max_results: 10    # Résultats par requête

    # Configuration spécifique par provider
    providers:
      brave:
        enabled: true
        rate_limit: 1.3        # Brave API recommande 1.1-1.5s
        timeout: 30
        retry_count: 3
        max_results: 10
        priority: 1

      serper:
        enabled: true
        rate_limit: 1.0        # Serper plus rapide
        timeout: 25
        retry_count: 3
        max_results: 10
        priority: 2

      tavily:
        enabled: true          # Activé (clé API disponible)
        rate_limit: 1.0
        timeout: 30
        retry_count: 3
        max_results: 10
        priority: 3

      ddgs:
        enabled: true
        rate_limit: 2.0        # Plus prudent pour éviter blocage
        timeout: 20            # Plus court (scraping)
        retry_count: 2         # Moins de retries
        max_results: 10
        priority: 4
  risk_thresholds:
    concentration_etablissement_critique: 50
    concentration_etablissement_eleve: 30
    concentration_juridiction_critique: 80
    concentration_juridiction_eleve: 60
    liquidite_critique: 5000
    liquidite_faible: 15000

generator:
  input_file: "patrimoine_analysis.json"
  template_file: "rapport_template.html"
  output_prefix: "rapport_"
  date_format: "%Y%m%d_%H%M%S"

logging:
  level: "INFO"
  format: "[%(asctime)s] %(levelname)s: %(message)s"
  date_format: "%Y-%m-%d %H:%M:%S"

analysis:
  config_file: "analysis.yaml"  # Fichier de configuration pour l'analyse

  # v2.0: Le profil est maintenant défini dans manifest.json → profil_investisseur.investissement.profil_risque
  # active_profile_override permet de forcer un profil (pour tests uniquement)
  # Si null ou absent, le profil du manifest est utilisé (comportement recommandé)
  active_profile_override: null  # null = utiliser manifest.json, ou "dynamique"/"equilibre"/"prudent" pour override
